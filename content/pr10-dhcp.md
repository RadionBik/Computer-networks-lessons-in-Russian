pr10-dhcp

# Практическая работа №10. Протокол DHCP

Цель: изучить принципы работы технологии DHCP и применить ее на оборудовании Cisco.

Протокол DHCP \(Dynamic Host Configuration Protocol\) предназначен для автоматической конфигурации IP-параметров хостов в сети, таких как IP-адрес, маска сети, шлюз по умолчанию, DNS-сервер. Устройство отвечающее за выдачу этих параметров, называется DHCP-сервером, который может быть отдельном устройством, или, в случае небольшой сети, может быть настроен на роутере. Различают 3 режима распределения конфигураций по DHCP:

1. Ручной. Администратор указывает конфигурацию каждого устройства на сервере.

2. Автоматический. Сервер самостоятельно выдаёт адреса устройствам из пула адресов, которые фиксируются за устройством на постоянной основе.

3. Динамический. Адреса выдаются автоматически только на определённый промежуток времени – lease time \(например, 24 часа\) или до тех пор, пока устройство нуждается в нем. По истечению срока, клиент должен запросить новый – сервер выдаёт, обычно, тот же самый.

Процесс работы может быть описан следующим образом:

1. При активации клиента, он инициирует обмен сообщениями с поиска доступных серверов с помощью DHCPDISCOVER запроса, где указываются широковещательные MAC и IP-адреса получателя в заголовках

2. После получения DHCPDISCOVER, сервер резервирует IP-адрес для клиента и отправляет DHCPOFFER \(unicast\) с предложенным адресом.

3. В ответ, клиент отвечает с DHCPREQUEST \(broadcast\), где подтверждает получения адреса. В случае наличия других серверов в сегменте, они воспринимают это сообщение как отказ. В случае истечение lease-time, клиент также использует этот тип сообщения для продления срока пользования.

4. По получении DHCPREQUEST, сервер выполняет ICMP-ping по этому адресу, чтобы убедиться в доступности адреса и отправляет DHCPACK, который подтверждает клиенту доступность. Клиент, в свою очередь, выполняет самообращенный ARP-запрос по этому адресу и, в случае отсутствия ответа, присваивает его себе. Процедура аналогична и для продления срока пользования адресом.

Сообщения формата DHCP инкапсулируются в UDP-протокол. Клиент отправляет сообщения, указывая в качестве UDP-порта источника 68, получателя – 67. В случае сервера – наоборот.

Часто бывает, что для некоторых устройств нельзя присваивать динамические адреса \(принтеры, серверы, роутеры\), т.к. они должны быть доступны всегда по известному адресу. В таком случае, адреса подобных устройств исключаются из процесса DHCP :

```
Router(config)# ip dhcp excluded-address 192.168.10.1 192.168.10.10 % в данном случае указан ДИАПАЗОН адресов, возможно также указать только один адрес
```

Дальнейшая настройка заключается в указании пула, из которого будут раздаваться адреса:

`Router(config)# ip dhcp pool pool-name`

Непосредственная настройка параметров DHCP:

```
Router(dhcp-config)# network network-address mask %указываем пул посредством адреса сети и маски
Router(dhcp-config)# default-router ip-address%адрес шлюза по-умолчанию
```

Остальные параметры опциональны:

```
Router(dhcp-config)# dns-serverip-address %адрес DNS-сервера
Router(dhcp-config)# domain-name example.com %указание имени домена, для доп. идентификации
```

Для деактивации сервиса выполнить:

`Router(config)# no service dhcp`

В случае, если DHCP-сервер находится в другой сети, можно настроить DHCP-relay на подключенном к сети интерфейсе роутера, которой нужна помощь в нахождении сервиса. Этот интерфейс будет транслировать широковещательные кадры сервиса в ту сеть, которой принадлежит необходимый сервис \(DNS, DHCP, TFTP и т.д.\):

```
Router(config)# interface g0/0
Router(config-if)# ip helper-address ip-address % указываем адрес устройства, на котором работает сервис, будь-то роутер или сервер
```

Как было упомянуто, интерфейсы тоже можно настроить на получение адресов по DHCP, например:

```
Router(config)# interface g0/0
Router(config-int)# ip address dhcp
```

Для диагностики сервиса выполнять:

```
Router# show running-config | section dhcp %просмотр секции с сервисом в текущей конфигурации
Router# show ip dhcp binding %просмотр выданных адресов
Router# show ip dhcp server statistics %просмотр статистики по DHCP сообщениям
Router# debug ip dhcp server events % можно отслеживать присвоения процесс DHCP в реальном времени
```

**Задание**

1. Настроить DHCP-сервис на R1 в соответствии с планом адресации сети. Пулы адресов для каждой сети с клиентами выбрать самостоятельно, адреса по DHCP должны назначаться только клиентам.

2. На остальных роутерах необходимо правильно настроить _ip helper-address_, чтобы хосты из их сетей получали адреса от сервера на R1.

3. Проверить работоспособность сервиса.

4. Сделать выводы
