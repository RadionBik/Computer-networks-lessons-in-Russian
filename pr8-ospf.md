# ПР8. Протокол OSPF

Цель: изучить принципы динамической маршрутизации на примере OSPF и реализовать в Packet Tracer.

С ростом размеров сети, поддержка и настройка статических маршрутов становится сложной задачей. Для того, чтобы автоматизировать настройку маршрутов в сети, были разработаны протоколы динамической маршрутизации. В отличие от статической маршрутизации, динамическая потребляет гораздо больше вычислительных и сетевых ресурсов. Классификация динамических протоколов маршрутизации по домену применения, типу алгоритма и их примеры приведены на Рисунок. Автономная система \(АС\) – набор роутеров, использующих одинаковый протокол маршрутизации \(сеть предприятия, провайдера\). Interior Gateway Protocol \(IGP\) протоколы обеспечивают маршрутизацию внутри АС, а Exterior GP \(EGP\) – между АС. Векторные протоколы знают только расстояние до желаемой сети и направление \(выходной интерфейс\), не зная всей топологии сети, в отличие от Link-State протоколов.

Динамические протоколы маршрутизации выполняют следующие функции:

* объявление непосредственно подключённых сетей на устройстве;

* поддержка таблицы маршрутизации в актуальном состоянии;

* выбор оптимального маршрута;

* поиск нового оптимального маршрута, при изменениях в сети.

Для осуществления подобного функционала, протоколы используют таблицы/базы данных \(для хранения информации\), особый тип сообщений \(IP-пакеты для передачи данных\) и алгоритм для поиска маршрутов.

Рисунок 9: Классификация динамических протоколов маршрутизацииПри инициализации, роутеры сначала добавляют в таблицу маршрутизации только непосредственно подключённые сети. Далее, формируется пакет обновлений, который через все интерфейсы отправляется с данными обо всех непосредственно подключённых сетях, кроме сети выходного интерфейса. Таблица маршрутизации актуализируется и формируется новый пакет обновлений. Процесс продолжается до достижения конвергенции \(когда вся информация о сети получена на каждом из устройств\). Наилучшими протоколами в плане достижения конвергенции считаются OSPF, IS-IS, EIGRP.

Для оценки маршрутов используются метрики маршрутизации. Они могут быть основаны на разных параметрах, например, количество хопов до сети, пропускная способность линка и т.д.

OSPF протокол в процессе инициализации проходит следующие этапы:

1. Рассылка Hello-сообщений для установления доступности соседей. В дальнейшем, эти сообщения рассылаются регулярно для проверки доступности соседей.

2. Формирование Link-State Advertisements \(LSAs\), для интерфейсов, где доступны соседи. Обновления содержат параметры подключённых сетей, тип и метрики интерфейсов.

3. Рассылка LSAs всем соседям, которые их сразу же пересылают уже своим соседям.

4. По окончании рассылки, происходит формирование топологии сети по Link-state Database \(LSDB\) и вычисление кратчайших маршрутов

В больших сетях, имеет смысл разбивки сети \(АС\) на домены маршрутизации, в том числе для уменьшения объёмов вычислений при формировании маршрутов. Таким образом, в каждом домене формируется свой LSDB, эти домены иерархически связываются с опорным доменом \(backbone area\), который обеспечивает связь между доменами маршрутизации. Роутеры, связывающие домены, называются Area Border Routers \(ABRs\).

Настройка маршрутизации OSPF проходит следующим образом:

Router\(config\)\# router ospfprocess-id %process-id не влияет на работу сети, выбирается администратором, обычно присваивают 1

Каждому роутеру может быть явно присвоен Router ID для идентификации роутера в OSPF процессе и для выборов DR \(Designated Router\). По умолчанию, в качестве Router ID выбирается наибольший IP-адрес активного интерфейса, но при наличии loopback-интерфейса, последний имеет приоритет. Каждый роутер устанавливает таблицу связей \(соседей\), каждому из которых он будет посылать LSA пакеты. При большом количестве роутеров, количество связей растёт согласно n\(n-1\)/2 \(n – количество роутеров\), т.е. количество отправок LSA пакетов равно количеству связей, что ведёт к взрывному росту трафика \(flooding of LSAs\) в сети при подключении роутеров в одном широковещательном домене. Для обхода этой проблемы один из роутеров назначается ведущим \(Designated Router\), который управляет процессом пересылки сообщений в домене. Также выбирается резервным ведущий роутер \(Backup DR\), остальные становятся – DROTHER. Процесс выбора происходит по величине Router ID, обладатель наибольшего идентификатора становится DR. Пример настройки Router ID:

Router\(config-router\)\# router-id 1.1.1.1

Для объявления доступных сетей для процесса OSPF, необходимо активировать их рассылку следующим образом:

Router\(config-router\)\# network network-address wildcard-mask area area-id % в случае сети с одним доменом маршрутизации, принято указывать 0 в качестве area-id, wildcard mask это \(255.255.255.255 — mask\)

Можно избежать расчёта маски wildcard, если указать адрес интерфейса, вместо адреса сети:

Router\(config-router\)\# networkinterface-ip-address0.0.0.0 areaarea-id

Обычно, Hello-пакеты рассылаются по всем интерфейсам, которые были анонсированы для OSPF, даже если на другом конце линии нет роутера. Процесс рассылки сообщений хостам нежелателен, т.к. вызывает дополнительное потребление ресурсов сети→подобные интерфейсы следует деактивировать для рассылки Hello-сообщений, но оставив их сети активными для процесса OSPF. Для дезактивация рассылки подобных сообщений можно выполнить команду:

Router\(config-router\)\# passive-interface g0/0

После конфигурации маршрутизации и для проверки работы OSPF следует выполнять следующие команды:

Router\# show ip ospf neighbor %показывает соседей, с которыми сформированы связи

show ip ospf interface brief %итог настройки интерфейсов с OSPF

Router\# show ip protocols

Router\# show ip ospf

Из возможных причин неработоспособности протокола можно выделить:

* Несовпадение масок сетей на роутерах.

* OSPF Hello или Dead таймеры не совпадают.

* Некорректная команда OSPF network.

Задание:

1. Прежде чем выполнять работу, убедитесь, что статические маршруты удалены.

2. Используя топологию сети и план адресации из ПР №7, настроить OSPF маршрутизацию на роутерах, указав area 0, Router ID — выбрать самостоятельно, но таким образом, чтобы последний октет совпадал с номером роутера. Отключить лишние интерфейсы от процесса рассылки сообщений Hello.

3. Проверить работоспособность сети, выполнив диагностические команды.

4. Сделать выводы.

Задание для студента: привести и кратко описать основные этапы формирования соседства в OSPF \(init, 2-way, etc.\)

 

