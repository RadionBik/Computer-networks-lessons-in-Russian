# Практическая работа №11. Технология NAT

Цель: изучить назначение и способы конфигурации технологии NAT.

NAT \(Network Address Translation\) – это технология трансляции сетевых адресов. Например, компьютеры внутреннего сегмента, использующие серый диапазон для адресов \(сеть как 192.168.0.0/24\), получают доступ в интернет за счёт трансляции своих адресов во внешний белый адрес, который может быть маршрутизирован в интернете.

Преимущества технологии:

1. Консервация белых адресов \(маршрутизируемых в Интернете\), т.к. их количество ограничено и недостаточно для всех желающих.

2. Повышение безопасности внутреннего сегмента, т.к. адреса хостов неизвестны за NAT-транслятором.

3. Изменения схемы адресации публичных адресов не влияет на адресацию хостов во внутреннем сегменте.

Недостатки:

1. Понижение производительность из-за конверсии заголовков пакетов на старом оборудовании.

2. Непрерывность соединения нарушается, что может привести к ограничению функциональности и соединения. Например, приложения на хостах, находящихся за разными NAT, не смогут коммуницировать без помощи промежуточного сервера в интернете.

Роутеры с активным NAT могут быть настроены с одним или несколькими белыми адресами \(NAT pool\). Различают такие типы адресов:

С точки зрения устройства:

* Внутренний \(источник\) – адрес устройства, который будет транслироваться NAT.

* Внешний \(получатель\) – адрес устройства назначения

С точки зрения NAT:

* Локальный – адрес во внутреннем сегменте сети

* Глобальный – адрес во внешней части сети

Итого, возможно 4 типа адресов.

По принципу работы выделяют 3 типа NAT:

1**.Статический**. Локальные и глобальные адреса транслируются 1-к-1. Значит, количество белых адресов должно совпадать с количеством серых. Пример применения: веб-серверы и устройства, которые должны иметь постоянную доступность извне.

2.**Динамический**. Адреса назначаются 1-к-1, как и в статическом, но при этом они назначаются динамически, по мере необходимости назначая их из пула свободных белых адресов.

3.**PAT \(Port Address Translation\)** – известен также как NAT overloading. Присваивает несколько приватных адресов одному белому. По такому принципу работает большинство домашних роутеров – самая распространённая форма NAT. При этом, идентификация роутером хостов возможна, т.к. каждый внутренний узел генерирует свой номер TCP/UDP порта \(4-й уровень\) во время установки TCP/IP сессии, что позволяет идентифицировать клиента во время трансляции адресов. В том случае, когда номера портов источника совпадают у 2-х узлов во внутреннем сегменте, то второму хосту назначается следующий свободный номер порта. В том случае, когда коммуникации не имеют 4-го уровня, то для успешной конверсии адресов хостов используются другие идентификаторы, такие как Query ID при команде _ping_.

Из-за изменения TCP/UDP-портов, неизбежно влияние на работоспособность некоторых приложений. Для избежания подобного, используется технология port-forwarding, что позволяет задать известное правило конверсии портов.

Пример конфигурации **Статического** NAT:

```
Router(config)# ip nat inside source static 192.168.10.254 209.165.201.5 
Router(config)# interface s0/0/0
Router(config-if)# ip nat inside 
Router(config)# interface s0/0/1
Router(config-if)# ip nat outside
```

> 1. Указываем, что это статический тип конверсии с 1-го адреса на 2-ой.
> 2. Указываем использовать NAT, интерфейсу «смотрящему» во внутреннюю сеть
> 3. Делаем подобное для внешнего интерфейса

Команды для верификации работы NAT:

```
Router# show ip nat translations % просмотр конверсий
Router# show ip nat statistics %просмотр статистики
```

Пример конфигурации **Динамического** NAT:

```
Router(config)# ip nat pool PUBLIC-POOL 209.165.200.241 209.165.200.250 netmask 255.255.255.224 
Router(config)# access-list 2 permit 192.168.10.0 0.0.0.255 
Router(config)# ip nat inside source list 2 pool PUBLIC-POOL 
Router(config)# interface Serial0/0/0
Router(config-if)# ip nat inside 
Router(config)# interface Serial0/1/0
Router(config-if)# ip nat outside 
```

> 1. Указываем ИМЯ пула белых адресов, первый адрес пула, последний, и МАСКУ, которая указывает какая часть адреса принадлежит сети, какая – хосту
> 2. Устанавливаем стандартный список доступа №2 \(любой номер из диапазона\), который разрешает определённым внутренним хостам иметь доступ к конверсии
> 3. Связываем указанный пул адресов с настроенным списком доступа
> 4. Активируем NAT на интерфейсах

Для очистки динамических назначений, выполнять:

```
Router# сlear ip nat translation * % * – очищает ВСЕ. Возможно очистка только определённых назначений(используй автодополнение)
```

Настройка **PAT. **Для нескольких публичных адресов, настройка идентична динамической, за исключением этапа привязки пула и списка доступа:

```
Router(config)# ip nat inside source list 2 pool PUBLIC-POOL overload %в конце добавлена опция overload, которая и активирует PAT.
```

Для случая с одним публичным адресом:

```
Router(config)# ip nat inside source list 2 interface serial0/1/0 overload 
Router(config)# access-list 2 permit 192.168.0.0 0.0.255.255
Router(config)# interface serial0/0/0
Router(config-if)# ip nat inside
Router(config)# interface serial0/1/0
Router(config-if)# ip nat outside
```

> Вместо адреса \(как в статической трансляции\), указываем интерфейс, на котором уже настроен внешний адрес

**Задание**

1. Настроить PAT на R1 для трансляции всех хостов из внутренней сети на один адрес \(последовательного интерфейса\).

2. Проверить работоспособность сети. Устранить неполадки, если есть.

3. Проверить конфигурацию

4. Сделать выводы

 

